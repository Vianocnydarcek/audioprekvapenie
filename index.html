<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Je≈æi≈°kov 3D Robo-kamo≈°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        #container { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
        
        /* Prekr√Ωvaj√∫ce UI */
        .overlay { position: absolute; top: 20px; width: 90%; max-width: 400px; z-index: 10; text-align: center; pointer-events: none; }
        .ui-element { pointer-events: auto; background: rgba(255,255,255,0.9); color: #333; padding: 20px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #three-canvas-container { width: 100%; height: 350px; cursor: grab; }
        .speech { font-weight: bold; margin-bottom: 10px; min-height: 40px; font-size: 15px; }
        
        .btn { background: #00d2ff; color: white; border: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; pointer-events: auto; }
        .progress-bg { background: #ddd; height: 12px; border-radius: 6px; overflow: hidden; margin: 10px 0; display: none; }
        .progress-fill { background: #00d2ff; width: 0%; height: 100%; transition: width 0.3s; }
        
        .book-card { background: white; border: 2px solid #eee; border-radius: 15px; padding: 12px; margin: 8px 0; display: none; cursor: pointer; text-align: left; pointer-events: auto; }
        #voucher { display: none; background: #fff9c4; padding: 20px; border-radius: 20px; border: 3px dashed #f1c40f; pointer-events: auto; }
    </style>
</head>
<body>

<div id="container">
    <div id="three-canvas-container"></div>

    <div class="overlay">
        <div class="ui-element" id="ui-box">
            <div class="speech" id="dialogue">Inicializujem 3D neur√≥nov√∫ sie≈•...</div>
            
            <div id="p1">
                <input type="text" id="d-name" placeholder="Pomenuj ma..." style="padding:12px; border-radius:10px; border:1px solid #ccc; width:60%;">
                <button class="btn" onclick="startApp()">OK</button>
            </div>

            <div id="p2" class="progress-bg"><div id="bar" class="progress-fill"></div></div>
            
            <div id="p3">
                <div class="book-card" onclick="bt(1)">üèùÔ∏è <strong>Spr√°vna pƒõtka</strong></div>
                <div class="book-card" onclick="bt(2)">üêï <strong>O chlapcovi, ktor√Ω rozumel psom</strong></div>
                <div class="book-card" onclick="bt(3)">üöÄ <strong>Robopes</strong></div>
                <button class="btn" id="gift-btn" style="display:none; background:#f1c40f; color:black; margin-top:10px;" onclick="showF()">üéÅ DARƒåEK</button>
            </div>

            <div id="voucher">
                <h3 style="margin:0">Je≈æi≈°kov k√≥d:</h3>
                <div style="font-size: 24px; font-weight: bold; margin:10px 0;">EECHPLKMKBHH</div>
                <a href="https://www.audiolibrix.com/sk/User/Register?returnUrl=%2Fsk" target="_blank"><button class="btn">POƒå√öVA≈§</button></a>
            </div>
        </div>
    </div>
</div>

<script>
    let scene, camera, renderer, dogHead, eyes = [];
    let happy = 0, stage = 0, dogName = "";

    // --- 3D ENGINE ≈†TART ---
    function init3D() {
        const container = document.getElementById('three-canvas-container');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // Svetl√° (dodaj√∫ ten kovov√Ω lesk)
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 5, 5).normalize();
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040, 2));

        // Tvorba "3D Uhladen√©ho Psa" (Hlava)
        const metalMat = new THREE.MeshStandardMaterial({ color: 0xbdc3c7, metalness: 0.9, roughness: 0.1 });
        const eyeMat = new THREE.MeshBasicMaterial({ color: 0x00d2ff });

        dogHead = new THREE.Group();
        
        // Lebka
        const skull = new THREE.Mesh(new THREE.SphereGeometry(1, 32, 32), metalMat);
        dogHead.add(skull);

        // ≈áuf√°k
        const snout = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.6, 0.8, 32), metalMat);
        snout.rotation.x = Math.PI / 2;
        snout.position.z = 0.8;
        dogHead.add(snout);

        // U≈°i
        const earG = new THREE.BoxGeometry(0.2, 0.8, 0.4);
        const earL = new THREE.Mesh(earG, metalMat);
        earL.position.set(-0.8, 0.8, 0);
        earL.rotation.z = 0.4;
        dogHead.add(earL);
        const earR = new THREE.Mesh(earG, metalMat);
        earR.position.set(0.8, 0.8, 0);
        earR.rotation.z = -0.4;
        dogHead.add(earR);

        // Oƒçi (Svietiace modr√©)
        const eyeG = new THREE.SphereGeometry(0.15, 16, 16);
        const eL = new THREE.Mesh(eyeG, eyeMat); eL.position.set(-0.4, 0.3, 0.85);
        const eR = new THREE.Mesh(eyeG, eyeMat); eR.position.set(0.4, 0.3, 0.85);
        dogHead.add(eL); dogHead.add(eR);
        eyes = [eL, eR];

        scene.add(dogHead);
        camera.position.z = 3.5;

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        if(dogHead) {
            dogHead.rotation.y += 0.005; // Pomal√© ot√°ƒçanie
            // Reakcia na ≈°≈•astie
            if(happy > 0 && happy < 100) {
                dogHead.position.y = Math.sin(Date.now() * 0.01) * 0.1;
            }
        }
        renderer.render(scene, camera);
    }

    // --- LOGIKA A HLAS ---
    function talk(t) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'sk-SK'; m.pitch = 1.2;
        document.getElementById('dialogue').innerText = t;
        window.speechSynthesis.speak(m);
    }

    function startApp() {
        const val = document.getElementById('d-name').value;
        if(!val) return;
        dogName = val; stage = 1;
        document.getElementById('p1').style.display = 'none';
        document.getElementById('p2').style.display = 'block';
        talk("Ahoj Zoe! Ja som tvoj nov√Ω 3D spoloƒçn√≠k " + dogName + ". Je≈æi≈°ko ma pre teba vyrobil z vesm√≠rneho kovu. Sk√∫s ma pohladi≈• po hlave, nech sa mi nabij√∫ bat√©rie!");
    }

    // Detekcia hladkania na 3D modeli
    document.addEventListener('touchstart', () => {
        if(stage === 1) {
            happy += 5;
            document.getElementById('bar').style.width = Math.min(happy, 100) + "%";
            if(happy >= 100) finishStage1();
        }
    });

    function finishStage1() {
        stage = 2;
        document.getElementById('p2').style.display = 'none';
        talk("Vau! Moje senzory ≈æiaria! Zoe, Je≈æi≈°ko mi dal kƒæ√∫ƒç k tvojmu darƒçeku. Pozri na tieto pr√≠behy!");
        setTimeout(() => {
            document.querySelectorAll('.book-card').forEach(c => c.style.display = 'block');
        }, 2000);
    }

    function bt(id) {
        confetti({particleCount: 20});
        if(id === 1) talk("Spr√°vna pƒõtka! Poriadne dobrodru≈æstvo na ostrove.");
        if(id === 2) talk("Tento chlapec rozumie psom. Skoro ako ty mne!");
        if(id === 3) talk("Robopes! M√¥j kamo≈° z plechu, s n√≠m je veƒæk√° sranda.");
        document.getElementById('gift-btn').style.display = 'block';
    }

    function showF() {
        document.getElementById('p3').style.display = 'none';
        document.getElementById('voucher').style.display = 'block';
        talk("≈†≈•astn√© Vianoce Zoe! Tu je tvoj k√≥d.");
        confetti({particleCount: 150, spread: 70});
    }

    window.onload = () => {
        init3D();
        setTimeout(() => talk("Ahoj Zoe! Je≈æi≈°ko mi o tebe rozpr√°val. Poslal ma za tebou z vianoƒçnej dielne. Ako ma pomenuje≈°?"), 1000);
    };
</script>
</body>
</html>
